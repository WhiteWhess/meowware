package wtf.whess.meowware.client.main.commands.impl.exploit;

import net.minecraft.client.gui.GuiPlayerTabOverlay;
import net.minecraft.client.multiplayer.GuiConnecting;
import net.minecraft.client.network.NetHandlerPlayClient;
import net.minecraft.client.network.NetworkPlayerInfo;
import wtf.whess.meowware.client.api.utilities.client.ChatUtil;
import wtf.whess.meowware.client.main.commands.Command;

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.util.List;

public final class Creatives extends Command {
    public Creatives() {
        super("Creatives", "Creatives check", "", "creative", "creat", "c");
    }

    @Override
    public void onCommand(String[] args, String command) {
        try {
            NetHandlerPlayClient connection = mc.player.connection;
            List<NetworkPlayerInfo> players = GuiPlayerTabOverlay.ENTRY_ORDERING.sortedCopy(connection.getPlayerInfoMap());
            File txt = new File(System.currentTimeMillis() + GuiConnecting.iip + GuiConnecting.pport + "_creatives.txt");
            if (txt.exists()) {
                if (!txt.delete())
                    throw new RuntimeException();
            } else {
                if (!txt.createNewFile())
                    throw new RuntimeException();
            }
            for (NetworkPlayerInfo n : players) {
                if (n.getGameType().isCreative()) {
                    FileWriter writer = new FileWriter(txt, true);
                    BufferedWriter bufferWriter = new BufferedWriter(writer);
                    bufferWriter.write(n.getGameProfile().getName() + "\n");
                    bufferWriter.close();
                }
            }
            ChatUtil.printChat("&aКреативы сохранены в " + txt.getAbsolutePath() + txt.getName());
        } catch (Exception eg) {
            eg.printStackTrace();
        }

    }
}
